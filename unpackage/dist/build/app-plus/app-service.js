if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}const a=t=>(a,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,a,o)},o=a("onShow"),n=a("onHide"),l=a("onLaunch"),s=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a},i=s(e.defineComponent({__name:"index",setup(a){const o=e.ref([]),n=e.ref(1),l=e.ref(!1),s=e.ref(!1),i=e.ref(!1),r=e.ref("time"),c=e=>{const t=(new Date).getTime()-new Date(e).getTime();if(t<6e4)return"刚刚";if(t<36e5)return`${Math.floor(t/6e4)}分钟前`;if(t<864e5)return`${Math.floor(t/36e5)}小时前`;if(t<2592e6)return`${Math.floor(t/864e5)}天前`;const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`},u=async()=>{if(l.value)return;l.value=!0;const e=uni.getStorageSync("token");if(!e)return l.value=!1,void uni.showToast({title:"请先登录",icon:"none",success:()=>{setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)}});uni.request({url:"http://192.168.100.101:8080/api/posts",method:"GET",header:{Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${e}`},data:{type:"love",page:n.value,pageSize:10,sortBy:r.value},success:e=>{if(t("log","at pages/love/index.vue:162","获取帖子响应：",e),200===e.statusCode&&200===e.data.code){const{list:t,total:a}=e.data.data,l=t.map((e=>{const t=e.user||{};return{...e,user:{...t,avatar:t.avatar?`/api${t.avatar}`:null,name:t.name||"匿名用户"},content:e.content||"",images:(e.images||[]).map((e=>`http://192.168.100.101:8080/api${e}`)),likeCount:e.likeCount||0,commentCount:e.commentCount||0,isLiked:!!e.isLiked}}));1===n.value?o.value=l:o.value=[...o.value,...l],s.value=o.value.length>=a,i.value&&uni.showToast({title:"刷新成功",icon:"success"})}else 403===e.statusCode?(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.showToast({title:"登录已过期，请重新登录",icon:"none",success:()=>{setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)}})):uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/love/index.vue:219","获取帖子失败：",e),uni.showToast({title:"网络错误，请下拉刷新",icon:"none"})},complete:()=>{l.value=!1,i.value=!1,uni.stopPullDownRefresh()}})},d=e=>{r.value!==e&&(r.value=e,n.value=1,s.value=!1,u())},m=()=>{n.value=1,s.value=!1,i.value=!0,u()},p=()=>{s.value||l.value||(n.value++,u())},v=()=>{if(!uni.getStorageSync("token"))return uni.showToast({title:"请先登录",icon:"none"}),void setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500);uni.navigateTo({url:"/pages/post/create?type=love"})};return e.onMounted((()=>{u()})),(a,n)=>(e.openBlock(),e.createElementBlock("view",{class:"love-container"},[e.createElementVNode("view",{class:"sort-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"time"===r.value}]),onClick:n[0]||(n[0]=e=>d("time"))}," 最新 ",2),e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"hot"===r.value}]),onClick:n[1]||(n[1]=e=>d("hot"))}," 最热 ",2)]),e.createElementVNode("scroll-view",{class:"post-list","scroll-y":"",onScrollToLower:p,"refresher-enabled":"","refresher-triggered":i.value,onRefresherRefresh:m},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"post-item",key:a.id,onClick:e=>{return t=a.id,void uni.navigateTo({url:`/pages/post/detail?id=${t}`});var t}},[e.createElementVNode("view",{class:"post-header"},[e.createElementVNode("image",{class:"avatar",src:a.user&&a.user.avatar?`http://192.168.100.101:8080${a.user.avatar}`:"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(a.user?a.user.name:"匿名用户"),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(c(a.createTime)),1)])]),e.createElementVNode("view",{class:"post-content"},e.toDisplayString(a.content),1),a.images&&a.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:t,mode:"aspectFill",onClick:e.withModifiers((e=>{return t=a.images,n=o,void uni.previewImage({urls:t,current:t[n]});var t,n}),["stop"])},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"post-footer"},[e.createElementVNode("view",{class:"action",onClick:e.withModifiers((e=>(e=>{const a=uni.getStorageSync("token");a?uni.request({url:`http://192.168.100.101:8080/api/posts/${e.id}/like`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${a}`},success:a=>{t("log","at pages/love/index.vue:314","点赞响应：",a),200===a.statusCode&&200===a.data.code?(e.isLiked=!e.isLiked,e.likeCount=e.isLiked?e.likeCount+1:e.likeCount-1):uni.showToast({title:a.data.message||"操作失败",icon:"none"})},fail:e=>{t("error","at pages/love/index.vue:327","点赞失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):uni.showToast({title:"请先登录",icon:"none"})})(a)),["stop"])},[e.createElementVNode("text",{class:e.normalizeClass({active:a.isLiked})},"❤",2),e.createElementVNode("text",null,e.toDisplayString(a.likeCount||0),1)],8,["onClick"]),e.createElementVNode("view",{class:"action"},[e.createElementVNode("text",null,"💬"),e.createElementVNode("text",null,e.toDisplayString(a.commentCount||0),1)])])],8,["onClick"])))),128)),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)],40,["refresher-triggered"]),e.createElementVNode("view",{class:"post-btn",onClick:v},[e.createElementVNode("text",null,"＋")])]))}}),[["__scopeId","data-v-254151f9"]]),r=s({__name:"detail",setup(a){const o=e.ref(""),n=e.ref({}),l=e.ref([]),s=e.ref(""),i=e.ref(null),r=()=>{uni.showToast({title:"请重新登录",icon:"none"}),uni.removeStorageSync("token"),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)},c=()=>{const e=uni.getStorageSync("token");e?uni.request({url:`http://192.168.100.101:8080/api/posts/${o.value}`,method:"GET",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${e}`},success:e=>{var t,a;if(200===e.statusCode&&200===e.data.code){const o=e.data.data;n.value={...o,name:(null==(t=o.user)?void 0:t.name)||"匿名用户",avatar:(null==(a=o.user)?void 0:a.avatar)?`http://192.168.100.101:8080/api${o.user.avatar}`:"/static/default-avatar.png",images:(o.images||[]).map((e=>`http://192.168.100.101:8080/api${e}`))}}else 403===e.statusCode?r():uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/post/detail.vue:181","获取帖子详情失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):r()},u=()=>{const e=uni.getStorageSync("token");e?uni.request({url:`http://192.168.100.101:8080/api/posts/${o.value}/comments`,method:"GET",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${e}`},success:e=>{t("log","at pages/post/detail.vue:208","评论数据：",e.data),200===e.statusCode&&200===e.data.code?l.value=e.data.data.map((e=>{var t,a;return{...e,name:(null==(t=e.author)?void 0:t.name)||"匿名用户",avatar:(null==(a=e.author)?void 0:a.avatar)?`http://192.168.100.101:8080/api${e.author.avatar}`:"/static/default-avatar.png",replies:(e.replies||[]).map((e=>{var t,a;return{...e,name:(null==(t=e.author)?void 0:t.name)||"匿名用户",replyToName:(null==(a=e.replyTo)?void 0:a.name)||"匿名用户"}}))}})):403===e.statusCode?r():uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/post/detail.vue:230","获取评论列表失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):r()},d=()=>{var e;if(!s.value.trim())return void uni.showToast({title:"请输入评论内容",icon:"none"});const a=uni.getStorageSync("token");a?uni.request({url:`http://192.168.100.101:8080/api/posts/${o.value}/comments`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${a}`},data:{content:s.value,replyTo:null==(e=i.value)?void 0:e.id},success:e=>{200===e.statusCode&&200===e.data.code?(uni.showToast({title:"评论成功",icon:"success"}),s.value="",i.value=null,u(),c()):403===e.statusCode?r():uni.showToast({title:e.data.message||"评论失败",icon:"none"})},fail:e=>{t("error","at pages/post/detail.vue:287","提交评论失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):r()},m=()=>{const e=uni.getStorageSync("token");e?uni.request({url:`http://192.168.100.101:8080/api/posts/${o.value}/like`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${e}`},success:e=>{200===e.statusCode&&200===e.data.code?(n.value.isLiked=!n.value.isLiked,n.value.likeCount=n.value.isLiked?n.value.likeCount+1:n.value.likeCount-1):403===e.statusCode?r():uni.showToast({title:e.data.message||"操作失败",icon:"none"})},fail:e=>{t("error","at pages/post/detail.vue:334","点赞失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):r()},p=e=>{if(!e)return"";const t=(new Date).getTime()-new Date(e).getTime();if(t<6e4)return"刚刚";if(t<36e5)return`${Math.floor(t/6e4)}分钟前`;if(t<864e5)return`${Math.floor(t/36e5)}小时前`;if(t<2592e6)return`${Math.floor(t/864e5)}天前`;const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return e.onMounted((()=>{(()=>{var e;const t=getCurrentPages();if(t.length>0){const a=t[t.length-1],n=(null==(e=a.$page)?void 0:e.options)||a.options;n&&n.id?(o.value=n.id,c(),u()):(uni.showToast({title:"参数错误",icon:"none"}),setTimeout((()=>{uni.navigateBack()}),1500))}})()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"detail-container"},[e.createElementVNode("view",{class:"post-content"},[e.createElementVNode("view",{class:"post-header"},[e.createElementVNode("image",{class:"avatar",src:n.value.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(n.value.name),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(p(n.value.createTime)),1)])]),e.createElementVNode("view",{class:"content-text"},e.toDisplayString(n.value.content),1),n.value.images&&n.value.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-list"},[e.createElementVNode("view",{class:e.normalizeClass(["image-grid",[`grid-${n.value.images.length}`]])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value.images,((t,a)=>(e.openBlock(),e.createElementBlock("image",{key:a,src:t,mode:"aspectFill",onClick:e=>{return t=n.value.images,o=a,void uni.previewImage({urls:t,current:t[o]});var t,o},class:"grid-image"},null,8,["src","onClick"])))),128))],2)])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"post-footer"},[e.createElementVNode("view",{class:"action",onClick:m},[e.createElementVNode("text",{class:e.normalizeClass(["icon-font",{active:n.value.isLiked}])},"❤",2),e.createElementVNode("text",null,e.toDisplayString(n.value.likeCount||0),1)]),e.createElementVNode("view",{class:"action"},[e.createElementVNode("text",{class:"icon-font"},"💬"),e.createElementVNode("text",null,e.toDisplayString(n.value.commentCount||0),1)])])]),e.createElementVNode("view",{class:"comment-list"},[e.createElementVNode("view",{class:"comment-title"},"评论 "+e.toDisplayString(n.value.commentCount||0),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(l.value,(t=>(e.openBlock(),e.createElementBlock("view",{class:"comment-item",key:t.id},[e.createElementVNode("image",{class:"avatar",src:t.avatar,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"comment-right"},[e.createElementVNode("view",{class:"comment-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(p(t.createTime)),1)]),e.createElementVNode("view",{class:"comment-content"},e.toDisplayString(t.content),1),t.replies&&t.replies.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"reply-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.replies,(t=>(e.openBlock(),e.createElementBlock("view",{class:"reply-item",key:t.id},[e.createElementVNode("text",{class:"reply-username"},e.toDisplayString(t.name),1),e.createElementVNode("text",{class:"reply-text"},"回复"),e.createElementVNode("text",{class:"reply-to"},e.toDisplayString(t.replyToName)+"：",1),e.createElementVNode("text",{class:"reply-content"},e.toDisplayString(t.content),1)])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"comment-actions"},[e.createElementVNode("text",{onClick:e=>(e=>{i.value=e})(t)},"回复",8,["onClick"])])])])))),128)),l.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"no-comment"},"暂无评论"))]),e.createElementVNode("view",{class:"comment-input"},[e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),placeholder:i.value?`回复 ${i.value.name}`:"说点什么...",onConfirm:d},null,40,["placeholder"]),[[e.vModelText,s.value]]),e.createElementVNode("button",{class:"send-btn",disabled:!s.value.trim(),onClick:d},"发送",8,["disabled"])])]))}},[["__scopeId","data-v-085cef2a"]]),c=s({__name:"create",setup(a){const o=[{id:"love",name:"表白墙"},{id:"market",name:"二手交易"},{id:"job",name:"兼职信息"}],n=e.ref({}),l=e.ref(""),s=e.ref([]),i=e.ref(!1),r=e=>{n.value=o[e.detail.value]},c=()=>{uni.chooseImage({count:9-s.value.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{s.value=[...s.value,...e.tempFilePaths]},fail:e=>{uni.showToast({title:"选择图片失败",icon:"none"})}})},u=e=>new Promise(((a,o)=>{const n=uni.getStorageSync("token");n?uni.uploadFile({url:"http://192.168.100.101:8080/api/upload/image",filePath:e,name:"file",header:{Authorization:`Bearer ${n}`},success:e=>{t("log","at pages/post/create.vue:140","上传响应：",e);try{const t=JSON.parse(e.data);200===t.code?a(t.data):o(new Error(t.message||"图片上传失败"))}catch(n){t("error","at pages/post/create.vue:149","解析响应失败：",n,e.data),o(new Error("图片上传响应解析失败"))}},fail:e=>{t("error","at pages/post/create.vue:154","上传失败：",e),o(new Error("图片上传失败："+e.errMsg))}}):o(new Error("请先登录"))})),d=async()=>{if(n.value.id?l.value.trim()||(uni.showToast({title:"请输入内容",icon:"none"}),0):(uni.showToast({title:"请选择发布类型",icon:"none"}),0)){i.value=!0,uni.showLoading({title:"发布中..."});try{if(!uni.getStorageSync("token"))throw new Error("请先登录");const a=[];if(s.value.length>0){uni.showLoading({title:"上传图片中..."});for(let o of s.value)try{const e=await u(o);a.push(e)}catch(e){throw t("error","at pages/post/create.vue:216","图片上传失败：",e),new Error("图片上传失败，请重试")}}const o={type:n.value.id,content:l.value,images:a};await(e=>new Promise(((t,a)=>{const o=uni.getStorageSync("token");o?uni.request({url:"http://192.168.100.101:8080/api/posts",method:"POST",header:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},data:e,success:e=>{200===e.statusCode&&200===e.data.code?t(e.data.data):403===e.statusCode?a(new Error(" 403")):a(new Error(e.data.message||"发布失败"))},fail:e=>a(new Error("网络错误，请稍后重试"))}):a(new Error("请先登录"))})))(o),uni.hideLoading(),uni.showToast({title:"发布成功",icon:"success",success:()=>{uni.$emit("post-created"),setTimeout((()=>{uni.navigateBack()}),1500)}})}catch(e){t("error","at pages/post/create.vue:245","发布失败：",e),uni.hideLoading(),e.message.includes("登录")?uni.showToast({title:e.message,icon:"none",success:()=>{setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)}}):uni.showToast({title:e.message||"发布失败，请重试",icon:"none"})}finally{i.value=!1}}};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"post-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("picker",{mode:"selector",range:o,"range-key":"name",onChange:r},[e.createElementVNode("view",{class:"type-picker"},[e.createElementVNode("text",null,e.toDisplayString(n.value.name||"选择类型"),1),e.createElementVNode("text",{class:"arrow"},">")])],32)]),e.createElementVNode("view",{class:"form-item"},[e.withDirectives(e.createElementVNode("textarea",{class:"content-input","onUpdate:modelValue":a[0]||(a[0]=e=>l.value=e),placeholder:"说点什么吧...",maxlength:"500"},null,512),[[e.vModelText,l.value]]),e.createElementVNode("view",{class:"word-count"},e.toDisplayString(l.value.length)+"/500",1)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("view",{class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.value,((t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"image-item",key:a},[e.createElementVNode("image",{src:t,mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"delete-btn",onClick:e=>(e=>{s.value.splice(e,1)})(a)},"×",8,["onClick"])])))),128)),s.value.length<9?(e.openBlock(),e.createElementBlock("view",{key:0,class:"upload-btn",onClick:c},[e.createElementVNode("text",{class:"plus"},"+")])):e.createCommentVNode("",!0)])]),e.createElementVNode("button",{class:"submit-btn",onClick:d,disabled:i.value},e.toDisplayString(i.value?"发布中...":"发布"),9,["disabled"])]))}},[["__scopeId","data-v-8b028cf0"]]),u=s({__name:"index",setup(a){const o=e.ref([]),n=e.ref(1),l=e.ref(!1),s=e.ref(!1),i=e.ref(!1),r=e.ref("time"),c=()=>{uni.showToast({title:"请重新登录",icon:"none"}),uni.removeStorageSync("token"),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)},u=()=>{l.value||(l.value=!0,uni.request({url:"http://192.168.100.101:8080/api/posts",method:"GET",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${uni.getStorageSync("token")}`},data:{type:"market",page:n.value,pageSize:10,sortBy:r.value},timeout:1e4,dataType:"json",success:e=>{if(t("log","at pages/market/index.vue:130","获取帖子列表响应：",e),200===e.statusCode&&200===e.data.code){const{list:t,total:a}=e.data.data,l=t.map((e=>{const t=e.user||{};return{...e,user:{...t,avatar:t.avatar?`http://192.168.100.101:8080/api${t.avatar}`:"/static/default-avatar.png",name:t.name||"匿名用户"},content:e.content||"",images:(e.images||[]).map((e=>`http://192.168.100.101:8080/api${e}`)),likeCount:e.likeCount||0,commentCount:e.commentCount||0,isLiked:!!e.isLiked}}));1===n.value?o.value=l:o.value=[...o.value,...l],s.value=o.value.length>=a}else 403===e.statusCode?c():uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/market/index.vue:167","获取帖子列表失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{l.value=!1,i.value=!1}}))},d=e=>{r.value!==e&&(r.value=e,n.value=1,s.value=!1,u())},m=()=>{n.value=1,s.value=!1,i.value=!0,u()},p=()=>{s.value||l.value||(n.value++,u())},v=()=>{uni.getStorageSync("token")?uni.navigateTo({url:"/pages/post/create?type=market"}):c()},g=e=>{if(!e)return"";const t=(new Date).getTime()-new Date(e).getTime();if(t<6e4)return"刚刚";if(t<36e5)return`${Math.floor(t/6e4)}分钟前`;if(t<864e5)return`${Math.floor(t/36e5)}小时前`;if(t<2592e6)return`${Math.floor(t/864e5)}天前`;const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return e.onMounted((()=>{u()})),(a,n)=>(e.openBlock(),e.createElementBlock("view",{class:"market-container"},[e.createElementVNode("view",{class:"sort-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"time"===r.value}]),onClick:n[0]||(n[0]=e=>d("time"))}," 最新 ",2),e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"hot"===r.value}]),onClick:n[1]||(n[1]=e=>d("hot"))}," 最热 ",2)]),e.createElementVNode("scroll-view",{class:"post-list","scroll-y":"",onScrollToLower:p,"refresher-enabled":"","refresher-triggered":i.value,onRefresherRefresh:m},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"post-item",key:a.id,onClick:e=>{return t=a.id,void uni.navigateTo({url:`/pages/post/detail?id=${t}`});var t}},[e.createElementVNode("view",{class:"post-header"},[e.createElementVNode("image",{class:"avatar",src:a.user&&a.user.avatar?a.user.avatar:"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(a.user?a.user.name:"匿名用户"),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(g(a.createTime)),1)])]),e.createElementVNode("view",{class:"post-content"},e.toDisplayString(a.content),1),a.images&&a.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:t,mode:"widthFix",onClick:e.withModifiers((e=>{return t=a.images,n=o,void uni.previewImage({urls:t,current:t[n]});var t,n}),["stop"])},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"post-footer"},[e.createElementVNode("view",{class:"action",onClick:e.withModifiers((e=>(e=>{const a=uni.getStorageSync("token");a?uni.request({url:`http://192.168.100.101:8080/api/posts/${e.id}/like`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${a}`},timeout:1e4,dataType:"json",success:a=>{t("log","at pages/market/index.vue:252","点赞响应：",a),200===a.statusCode&&200===a.data.code?(e.isLiked=!e.isLiked,e.likeCount=e.isLiked?e.likeCount+1:e.likeCount-1):403===a.statusCode?c():uni.showToast({title:a.data.message||"操作失败",icon:"none"})},fail:e=>{t("error","at pages/market/index.vue:268","点赞失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):c()})(a)),["stop"])},[e.createElementVNode("text",{class:e.normalizeClass(["icon-font",{active:a.isLiked}])},"❤",2),e.createElementVNode("text",null,e.toDisplayString(a.likeCount||0),1)],8,["onClick"]),e.createElementVNode("view",{class:"action"},[e.createElementVNode("text",{class:"icon-font"},"💬"),e.createElementVNode("text",null,e.toDisplayString(a.commentCount||0),1)])])],8,["onClick"])))),128)),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)],40,["refresher-triggered"]),e.createElementVNode("view",{class:"post-btn",onClick:v},[e.createElementVNode("text",{class:"icon-font"},"+")])]))}},[["__scopeId","data-v-80077649"]]),d=s({__name:"index",setup(a){const o=e.ref([]),n=e.ref(1),l=e.ref(!1),s=e.ref(!1),i=e.ref(!1),r=e.ref("time"),c=()=>{uni.showToast({title:"请重新登录",icon:"none"}),uni.removeStorageSync("token"),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)},u=()=>{l.value||(l.value=!0,uni.request({url:"http://192.168.100.101:8080/api/posts",method:"GET",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${uni.getStorageSync("token")}`},data:{type:"job",page:n.value,pageSize:10,sortBy:r.value},timeout:1e4,dataType:"json",success:e=>{if(t("log","at pages/job/index.vue:131","获取帖子列表响应：",e),200===e.statusCode&&200===e.data.code){const{list:t,total:a}=e.data.data,l=t.map((e=>({...e,user:e.user||{},content:e.content||"",images:e.images||[],likeCount:e.likeCount||0,commentCount:e.commentCount||0})));1===n.value?o.value=l:o.value=[...o.value,...l],s.value=o.value.length>=a}else 403===e.statusCode?c():uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/job/index.vue:160","获取帖子列表失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{l.value=!1,i.value=!1}}))},d=e=>{r.value!==e&&(r.value=e,n.value=1,s.value=!1,u())},m=()=>{n.value=1,s.value=!1,i.value=!0,u()},p=()=>{s.value||l.value||(n.value++,u())},v=()=>{uni.getStorageSync("token")?uni.navigateTo({url:"/pages/post/create?type=job"}):c()},g=e=>{if(!e)return"";const t=(new Date).getTime()-new Date(e).getTime();if(t<6e4)return"刚刚";if(t<36e5)return`${Math.floor(t/6e4)}分钟前`;if(t<864e5)return`${Math.floor(t/36e5)}小时前`;if(t<2592e6)return`${Math.floor(t/864e5)}天前`;const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return e.onMounted((()=>{u()})),(a,n)=>(e.openBlock(),e.createElementBlock("view",{class:"job-container"},[e.createElementVNode("view",{class:"sort-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"time"===r.value}]),onClick:n[0]||(n[0]=e=>d("time"))}," 最新 ",2),e.createElementVNode("view",{class:e.normalizeClass(["sort-item",{active:"hot"===r.value}]),onClick:n[1]||(n[1]=e=>d("hot"))}," 最热 ",2)]),e.createElementVNode("scroll-view",{class:"post-list","scroll-y":"",onScrollToLower:p,"refresher-enabled":"","refresher-triggered":i.value,onRefresherRefresh:m},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(o.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"post-item",key:a.id,onClick:e=>{return t=a.id,void uni.navigateTo({url:`/pages/post/detail?id=${t}`});var t}},[e.createElementVNode("view",{class:"post-header"},[e.createElementVNode("image",{class:"avatar",src:a.user&&a.user.avatar?`http://192.168.100.101:8080/api${a.user.avatar}`:"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("text",{class:"username"},e.toDisplayString(a.user?a.user.name:"匿名用户"),1),e.createElementVNode("text",{class:"time"},e.toDisplayString(g(a.createTime)),1)])]),e.createElementVNode("view",{class:"post-content"},e.toDisplayString(a.content),1),a.images&&a.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:`http://192.168.100.101:8080${t}`,mode:"aspectFill",onClick:e.withModifiers((e=>{return t=a.images.map((e=>`http://192.168.100.101:8080${e}`)),n=o,void uni.previewImage({urls:t,current:t[n]});var t,n}),["stop"])},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"post-footer"},[e.createElementVNode("view",{class:"action",onClick:e.withModifiers((e=>(e=>{const a=uni.getStorageSync("token");a?uni.request({url:`http://192.168.100.101:8080/api/posts/${e.id}/like`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${a}`},timeout:1e4,dataType:"json",success:a=>{t("log","at pages/job/index.vue:245","点赞响应：",a),200===a.statusCode&&200===a.data.code?(e.isLiked=!e.isLiked,e.likeCount=e.isLiked?e.likeCount+1:e.likeCount-1):403===a.statusCode?c():uni.showToast({title:a.data.message||"操作失败",icon:"none"})},fail:e=>{t("error","at pages/job/index.vue:261","点赞失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}}):c()})(a)),["stop"])},[e.createElementVNode("text",{class:e.normalizeClass(["icon-font",{active:a.isLiked}])},"❤",2),e.createElementVNode("text",null,e.toDisplayString(a.likeCount||0),1)],8,["onClick"]),e.createElementVNode("view",{class:"action"},[e.createElementVNode("text",{class:"icon-font"},"💬"),e.createElementVNode("text",null,e.toDisplayString(a.commentCount||0),1)])])],8,["onClick"])))),128)),l.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading"},"加载中...")):e.createCommentVNode("",!0),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)],40,["refresher-triggered"]),e.createElementVNode("view",{class:"post-btn",onClick:v},[e.createElementVNode("text",{class:"icon-font"},"+")])]))}},[["__scopeId","data-v-5230efb0"]]),m=s({__name:"register",setup(a){const o=["2020级","2021级","2022级","2023级","2024级"],n=e.ref({studentId:"",password:"",confirmPassword:"",name:"",major:"",grade:"",avatarPath:"",avatarUrl:""}),l=e.ref(!1),s=()=>{uni.chooseImage({count:1,success:e=>{n.value.avatarPath=e.tempFilePaths[0],n.value.avatarUrl=e.tempFilePaths[0]},fail:e=>{t("error","at pages/user/register.vue:122","选择头像失败：",e),uni.showToast({title:"选择头像失败",icon:"none"})}})},i=e=>{n.value.grade=o[e.detail.value]},r=()=>{n.value.studentId&&n.value.password&&n.value.name?n.value.avatarPath?n.value.major?n.value.grade?n.value.password.length<6?uni.showToast({title:"密码至少6位",icon:"none"}):n.value.password===n.value.confirmPassword?(l.value=!0,uni.uploadFile({url:"http://192.168.100.101:8080/api/register",filePath:n.value.avatarPath,name:"file",header:{"Content-Type":"multipart/form-data"},formData:{studentId:n.value.studentId,password:n.value.password,name:n.value.name,major:n.value.major,grade:n.value.grade},success:e=>{const t=JSON.parse(e.data);200===t.code?(uni.showToast({title:"注册成功",icon:"success"}),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)):uni.showToast({title:t.message||"注册失败",icon:"none"})},fail:e=>{t("error","at pages/user/register.vue:220","注册失败：",e),uni.showToast({title:"注册失败",icon:"none"})},complete:()=>{l.value=!1}})):uni.showToast({title:"两次密码不一致",icon:"none"}):uni.showToast({title:"请选择年级",icon:"none"}):uni.showToast({title:"请输入专业",icon:"none"}):uni.showToast({title:"请上传头像",icon:"none"}):uni.showToast({title:"请填写必要信息",icon:"none"})},c=()=>{uni.navigateTo({url:"/pages/login/index"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"register-container"},[e.createElementVNode("view",{class:"avatar-upload"},[e.createElementVNode("image",{class:"avatar",src:n.value.avatarUrl||"/static/user_avatar.png",mode:"aspectFill",onClick:s},null,8,["src"]),e.createElementVNode("text",{class:"upload-text"},"点击上传头像")]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"学号"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"number",maxlength:"10","onUpdate:modelValue":a[0]||(a[0]=e=>n.value.studentId=e),placeholder:"请输入学号"},null,512),[[e.vModelText,n.value.studentId]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"姓名"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",maxlength:"10","onUpdate:modelValue":a[1]||(a[1]=e=>n.value.name=e),placeholder:"请输入姓名"},null,512),[[e.vModelText,n.value.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"专业"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",maxlength:"20","onUpdate:modelValue":a[2]||(a[2]=e=>n.value.major=e),placeholder:"请输入专业"},null,512),[[e.vModelText,n.value.major]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"年级"),e.createElementVNode("picker",{class:"picker",mode:"selector",range:o,onChange:i},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(n.value.grade||"请选择年级"),1)],32)]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"密码"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",maxlength:"20","onUpdate:modelValue":a[3]||(a[3]=e=>n.value.password=e),placeholder:"请输入密码（6-20位）"},null,512),[[e.vModelText,n.value.password]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"确认密码"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",maxlength:"20","onUpdate:modelValue":a[4]||(a[4]=e=>n.value.confirmPassword=e),placeholder:"请再次输入密码"},null,512),[[e.vModelText,n.value.confirmPassword]])]),e.createElementVNode("button",{class:"submit-btn",onClick:r,disabled:l.value},e.toDisplayString(l.value?"注册中...":"注册"),9,["disabled"]),e.createElementVNode("view",{class:"login-link",onClick:c}," 已有账号？去登录 ")]))}},[["__scopeId","data-v-65eec8e9"]]),p=s({__name:"index",setup(a){const o=e.ref({}),n=e.computed((()=>!!o.value.studentId)),l=e=>{n.value?uni.navigateTo({url:`/pages/user/posts?type=${e}`}):r()},s=()=>{n.value?uni.navigateTo({url:"/pages/user/collections"}):r()},i=()=>{n.value?uni.navigateTo({url:"/pages/user/settings"}):r()},r=()=>{uni.navigateTo({url:"/pages/login/index"})},c=()=>{uni.showModal({title:"提示",content:"确定要退出登录吗？",success:e=>{e.confirm&&(uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),o.value={},uni.showToast({title:"已退出登录",icon:"success"}))}})};return e.onMounted((()=>{(()=>{if(!uni.getStorageSync("token"))return void(o.value={});const e=uni.getStorageSync("userInfo");e?(o.value=e,o.value.avatar=`http://192.168.100.101:8080/api${o.value.avatar}`,t("log","at pages/user/index.vue:77","用户信息:",o.value)):t("warn","at pages/user/index.vue:79","未找到用户信息")})()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"user-container"},[e.createElementVNode("view",{class:"user-card"},[e.createElementVNode("view",{class:"user-info"},[e.createElementVNode("image",{class:"avatar",src:o.value.avatar?o.value.avatar:"/static/user_avatar.png",mode:"aspectFill "},null,8,["src"]),e.createElementVNode("view",{class:"info-right"},[e.createElementVNode("text",{class:"name"},e.toDisplayString(o.value.name||"未登录"),1),e.createElementVNode("text",{class:"student-id"},e.toDisplayString(o.value.studentId||"点击登录"),1)])])]),e.createElementVNode("view",{class:"menu-list"},[e.createElementVNode("view",{class:"menu-group"},[e.createElementVNode("view",{class:"menu-item",onClick:a[0]||(a[0]=e=>l("love"))},[e.createElementVNode("text",{class:"menu-text"},"我的表白"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:a[1]||(a[1]=e=>l("market"))},[e.createElementVNode("text",{class:"menu-text"},"我的二手"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:a[2]||(a[2]=e=>l("job"))},[e.createElementVNode("text",{class:"menu-text"},"我的兼职"),e.createElementVNode("text",{class:"arrow"},">")])]),e.createElementVNode("view",{class:"menu-group"},[e.createElementVNode("view",{class:"menu-item",onClick:s},[e.createElementVNode("text",{class:"menu-text"},"我的收藏"),e.createElementVNode("text",{class:"arrow"},">")]),e.createElementVNode("view",{class:"menu-item",onClick:i},[e.createElementVNode("text",{class:"menu-text"},"修改资料"),e.createElementVNode("text",{class:"arrow"},">")])]),e.createElementVNode("view",{class:"menu-group"},[n.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"menu-item",onClick:c},[e.createElementVNode("text",{class:"menu-text logout"},"退出登录")])):e.createCommentVNode("",!0)])])]))}},[["__scopeId","data-v-ef8ef671"]]),v=s(e.defineComponent({__name:"index",setup(a){const o=e.ref({studentId:"",password:""}),n=e.ref(!1),l=async()=>{(o.value.studentId?10!==o.value.studentId.length?(uni.showToast({title:"学号必须是10位",icon:"none"}),0):o.value.password||(uni.showToast({title:"请输入密码",icon:"none"}),0):(uni.showToast({title:"请输入学号",icon:"none"}),0))&&(n.value=!0,uni.request({url:"http://192.168.100.101:8080/api/login",method:"POST",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP"},data:{studentId:o.value.studentId,password:o.value.password},timeout:1e4,dataType:"json",success:e=>{if(t("log","at pages/login/index.vue:92","登录响应：",e),200===e.statusCode&&200===e.data.code){const{token:t,userInfo:a}=e.data.data;uni.setStorageSync("token",t),uni.setStorageSync("userInfo",a),uni.showToast({title:"登录成功",icon:"success",success:()=>{setTimeout((()=>{uni.switchTab({url:"/pages/love/index"})}),1500)}})}else uni.showToast({title:e.data.message||"登录失败",icon:"none"})},fail:e=>{t("error","at pages/login/index.vue:121","登录失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{n.value=!1}}))},s=()=>{uni.navigateTo({url:"/pages/user/register"})};return(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"学号"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"number","max-length":"10","onUpdate:modelValue":a[0]||(a[0]=e=>o.value.studentId=e),placeholder:"请输入学号"},null,512),[[e.vModelText,o.value.studentId]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"密码"),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password","onUpdate:modelValue":a[1]||(a[1]=e=>o.value.password=e),placeholder:"请输入密码"},null,512),[[e.vModelText,o.value.password]])]),e.createElementVNode("button",{class:"submit-btn",onClick:l,disabled:n.value},e.toDisplayString(n.value?"登录中...":"登录"),9,["disabled"]),e.createElementVNode("view",{class:"register-link",onClick:s}," 还没有账号？去注册 ")]))}}),[["__scopeId","data-v-2c4f9854"]]),g={__name:"posts",setup(a){const o=e.ref("love"),n=e.ref([]),l=e.ref(1),s=e.ref(!1),i=e.ref(!1),r=e.ref(!1),c=()=>{uni.showToast({title:"请重新登录",icon:"none"}),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)},u=()=>{s.value||(s.value=!0,t("log","at pages/user/posts.vue:112","1",uni.getStorageSync("token")),uni.request({url:"http://192.168.100.101:8080/api/posts/user/posts",method:"GET",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${uni.getStorageSync("token")}`},data:{type:o.value,page:l.value,pageSize:10},timeout:1e4,dataType:"json",success:e=>{if(t("log","at pages/user/posts.vue:131","获取帖子列表响应：",e),200===e.statusCode&&200===e.data.code){const{list:t,total:a}=e.data.data;1===l.value?n.value=t:n.value=[...n.value,...t],i.value=n.value.length>=a}else 403===e.statusCode?c():uni.showToast({title:e.data.message||"加载失败",icon:"none"})},fail:e=>{t("error","at pages/user/posts.vue:150","获取帖子列表失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{s.value=!1,r.value=!1}}))},d=e=>{o.value!==e&&(o.value=e,l.value=1,i.value=!1,u())},m=()=>{l.value=1,i.value=!1,r.value=!0,u()},p=()=>{i.value||s.value||(l.value++,u())},v=e=>{if(!e)return"";const t=(new Date).getTime()-new Date(e).getTime();if(t<6e4)return"刚刚";if(t<36e5)return`${Math.floor(t/6e4)}分钟前`;if(t<864e5)return`${Math.floor(t/36e5)}小时前`;if(t<2592e6)return`${Math.floor(t/864e5)}天前`;const a=new Date(e);return`${a.getFullYear()}-${String(a.getMonth()+1).padStart(2,"0")}-${String(a.getDate()).padStart(2,"0")}`};return e.onMounted((()=>{var e;const t=getCurrentPages();if(t.length>0){const a=(null==(e=t[t.length-1].$page)?void 0:e.options)||{};a.type&&(o.value=a.type)}uni.getStorageSync("token")?u():c()})),(a,g)=>(e.openBlock(),e.createElementBlock("view",{class:"my-posts-container"},[e.createElementVNode("view",{class:"type-bar"},[e.createElementVNode("view",{class:e.normalizeClass(["type-item",{active:"love"===o.value}]),onClick:g[0]||(g[0]=e=>d("love"))}," 表白墙 ",2),e.createElementVNode("view",{class:e.normalizeClass(["type-item",{active:"market"===o.value}]),onClick:g[1]||(g[1]=e=>d("market"))}," 二手市场 ",2),e.createElementVNode("view",{class:e.normalizeClass(["type-item",{active:"job"===o.value}]),onClick:g[2]||(g[2]=e=>d("job"))}," 兼职信息 ",2)]),e.createElementVNode("scroll-view",{class:"post-list","scroll-y":"",onScrollToLower:p,"refresher-enabled":"","refresher-triggered":r.value,onRefresherRefresh:m},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.value,(a=>(e.openBlock(),e.createElementBlock("view",{class:"post-item",key:a.id,onClick:e=>{return t=a.id,void uni.navigateTo({url:`/pages/post/detail?id=${t}`});var t}},[e.createElementVNode("view",{class:"post-content"},e.toDisplayString(a.content),1),a.images&&a.images.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"image-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.images,((t,o)=>(e.openBlock(),e.createElementBlock("image",{key:o,src:t,mode:"aspectFill",onClick:e.withModifiers((e=>{return t=a.images,n=o,void uni.previewImage({urls:t,current:t[n]});var t,n}),["stop"])},null,8,["src","onClick"])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"post-footer"},[e.createElementVNode("text",{class:"time"},e.toDisplayString(v(a.createTime)),1),e.createElementVNode("view",{class:"stats"},[e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"icon-font"},"❤"),e.createElementVNode("text",null,e.toDisplayString(a.likeCount||0),1)]),e.createElementVNode("view",{class:"stat-item"},[e.createElementVNode("text",{class:"icon-font"},"💬"),e.createElementVNode("text",null,e.toDisplayString(a.commentCount||0),1)])])]),e.createElementVNode("view",{class:"post-actions"},[e.createElementVNode("view",{class:"action-btn delete",onClick:e.withModifiers((e=>(e=>{uni.showModal({title:"提示",content:"确定要删除这条发布吗？",success:a=>{a.confirm&&uni.request({url:`http://192.168.100.101:8080/api/posts/user/${e.id}`,method:"DELETE",header:{"Content-Type":"application/json",Accept:"application/json","Device-Type":"APP",Authorization:`Bearer ${uni.getStorageSync("token")}`},timeout:1e4,dataType:"json",success:e=>{200===e.statusCode&&200===e.data.code?(uni.showToast({title:"删除成功",icon:"success"}),l.value=1,u()):403===e.statusCode?c():uni.showToast({title:e.data.message||"删除失败",icon:"none"})},fail:e=>{t("error","at pages/user/posts.vue:224","删除帖子失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})}})}})})(a)),["stop"])},"删除",8,["onClick"])])],8,["onClick"])))),128)),s.value||0!==n.value.length?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",null,"暂无发布内容")])),s.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"loading"},"加载中...")):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"no-more"},"没有更多了")):e.createCommentVNode("",!0)],40,["refresher-triggered"])]))}},w="http://192.168.100.101:8080",h=s({__name:"settings",setup(a){const o=e.ref({avatar:"",name:"",major:"",grade:""}),n=e.ref({oldPassword:"",newPassword:"",confirmPassword:""}),l=e.ref(!1),s=()=>{uni.showToast({title:"请重新登录",icon:"none"}),uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),setTimeout((()=>{uni.navigateTo({url:"/pages/login/index"})}),1500)},i=()=>{uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{t("log","at pages/user/settings.vue:151","选择图片成功：",e.tempFilePaths[0]);const a=e.tempFilePaths[0];a&&r(a)}})},r=e=>{const a=uni.getStorageSync("token");a?(uni.showLoading({title:"上传中..."}),uni.uploadFile({url:`${w}/upload/image`,filePath:e,name:"file",header:{Accept:"application/json",Authorization:`Bearer ${a}`},success:e=>{t("log","at pages/user/settings.vue:180","上传响应：",e);try{const n=JSON.parse(e.data);200===e.statusCode&&200===n.code?(o.value.avatar=n.data,uni.request({url:`${w}/api/user/update`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${a}`},data:{avatar:n.data,name:o.value.name},success:e=>{var a;t("log","at pages/user/settings.vue:201","更新用户信息响应：",e),200===e.statusCode&&200===e.data.code?(uni.setStorageSync("userInfo",o.value),uni.showToast({title:"头像更新成功",icon:"success"})):uni.showToast({title:(null==(a=e.data)?void 0:a.message)||"更新失败",icon:"none"})},fail:e=>{t("error","at pages/user/settings.vue:216","更新用户信息失败：",e),uni.showToast({title:"更新失败",icon:"none"})}})):uni.showToast({title:n.message||"上传失败",icon:"none"})}catch(n){t("error","at pages/user/settings.vue:230","解析响应失败：",n,e.data),uni.showToast({title:"上传失败",icon:"none"})}},fail:e=>{t("error","at pages/user/settings.vue:238","上传头像失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{uni.hideLoading()}})):s()},c=()=>{if(l.value)return;if(!o.value.name)return void uni.showToast({title:"请输入昵称",icon:"none"});if(n.value.oldPassword||n.value.newPassword||n.value.confirmPassword){if(!n.value.oldPassword)return void uni.showToast({title:"请输入原密码",icon:"none"});if(!n.value.newPassword)return void uni.showToast({title:"请输入新密码",icon:"none"});if(n.value.newPassword!==n.value.confirmPassword)return void uni.showToast({title:"两次密码输入不一致",icon:"none"})}const e=uni.getStorageSync("token");if(!e)return void s();l.value=!0;const a={name:o.value.name};n.value.oldPassword&&n.value.newPassword&&(a.oldPassword=n.value.oldPassword,a.newPassword=n.value.newPassword),uni.request({url:`${w}/api/user/update`,method:"POST",header:{"Content-Type":"application/json",Accept:"application/json",Authorization:`Bearer ${e}`},data:a,success:e=>{var t;200===e.statusCode&&200===e.data.code?(uni.setStorageSync("userInfo",o.value),uni.showToast({title:"保存成功",icon:"success"}),n.value.newPassword&&setTimeout((()=>{uni.removeStorageSync("token"),uni.removeStorageSync("userInfo"),uni.reLaunch({url:"/pages/login/index"})}),1500)):403===e.statusCode?s():uni.showToast({title:(null==(t=e.data)?void 0:t.message)||"保存失败",icon:"none"})},fail:e=>{t("error","at pages/user/settings.vue:341","更新用户信息失败：",e),uni.showToast({title:"网络错误，请稍后重试",icon:"none"})},complete:()=>{l.value=!1}})};return e.onMounted((()=>{(()=>{const e=uni.getStorageSync("token");e?uni.request({url:`${w}/api/user/info`,method:"GET",header:{Authorization:`Bearer ${e}`},success:e=>{var t;200===e.data.code?(o.value={...e.data.data,avatar:(null==(t=e.data.data.avatar)||t.startsWith("http"),e.data.data.avatar)},uni.setStorageSync("userInfo",o.value)):403===e.statusCode&&s()}}):s()})()})),(t,a)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"avatar-section",onClick:i},[e.createElementVNode("image",{class:"avatar",src:o.value.avatar?w+o.value.avatar:"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),e.createElementVNode("text",{class:"tip"},"点击更换头像")]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"基本信息"),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"昵称"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[0]||(a[0]=e=>o.value.name=e),placeholder:"请输入昵称"},null,512),[[e.vModelText,o.value.name]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"专业"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[1]||(a[1]=e=>o.value.major=e),placeholder:"请输入专业",disabled:""},null,512),[[e.vModelText,o.value.major]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"年级"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[2]||(a[2]=e=>o.value.grade=e),placeholder:"请输入年级",disabled:""},null,512),[[e.vModelText,o.value.grade]])])]),e.createElementVNode("view",{class:"form-section"},[e.createElementVNode("view",{class:"section-title"},"修改密码"),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"原密码"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[3]||(a[3]=e=>n.value.oldPassword=e),type:"password",placeholder:"请输入原密码"},null,512),[[e.vModelText,n.value.oldPassword]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"新密码"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[4]||(a[4]=e=>n.value.newPassword=e),type:"password",placeholder:"请输入新密码"},null,512),[[e.vModelText,n.value.newPassword]])]),e.createElementVNode("view",{class:"form-item"},[e.createElementVNode("text",{class:"label"},"确认密码"),e.withDirectives(e.createElementVNode("input",{class:"input","onUpdate:modelValue":a[5]||(a[5]=e=>n.value.confirmPassword=e),type:"password",placeholder:"请再次输入新密码"},null,512),[[e.vModelText,n.value.confirmPassword]])])]),e.createElementVNode("view",{class:"button-section"},[e.createElementVNode("button",{class:e.normalizeClass(["save-button",{loading:l.value}]),onClick:c,disabled:l.value},e.toDisplayString(l.value?"保存中...":"保存修改"),11,["disabled"])])]))}},[["__scopeId","data-v-e4747c37"]]);__definePage("pages/love/index",i),__definePage("pages/post/detail",r),__definePage("pages/post/create",c),__definePage("pages/market/index",u),__definePage("pages/job/index",d),__definePage("pages/user/register",m),__definePage("pages/user/index",p),__definePage("pages/login/index",v),__definePage("pages/user/posts",g),__definePage("pages/user/settings",h);const k={__name:"App",setup(a,{expose:s}){let i=0;l((()=>{t("log","at App.vue:151","App Launch"),uni.request({url:"http://192.168.100.101:8080/api/app/version",method:"GET",success:e=>{if(200===e.statusCode&&200===e.data.code){const t=e.data.data.version,a=e.data.data.forceUpdate,o=e.data.data.downloadUrl,n=e.data.data.updateContent;t>"1.0.0"&&uni.showModal({title:"发现新版本",content:n||"有新版本可用，是否立即更新？",confirmText:"立即更新",cancelText:a?"退出应用":"暂不更新",success:e=>{e.confirm?plus.runtime.openURL(o):a&&plus.runtime.quit()}})}},fail:e=>{t("error","at App.vue:49","检查更新失败：",e)}})})),o((()=>{t("log","at App.vue:159","App Show")})),n((()=>{t("log","at App.vue:165","App Hide")}));return s({onMemoryWarning:()=>{t("log","at App.vue:170","App MemoryWarning")},onLastPageBackPress:()=>{0===i?(t("log","at App.vue:176","App LastPageBackPress"),uni.showToast({title:"再按一次退出应用",position:"bottom"}),i=Date.now(),setTimeout((()=>{i=0}),2e3)):Date.now()-i<2e3&&(i=Date.now(),uni.exit())},onExit:()=>{t("log","at App.vue:193","App Exit")}}),(t,a)=>{const o=e.resolveComponent("page");return e.openBlock(),e.createElementBlock("view",null,[e.createVNode(o)])}}};uni.addInterceptor({returnValue:e=>!e||"object"!=typeof e&&"function"!=typeof e||"function"!=typeof e.then?e:new Promise(((t,a)=>{e.then((e=>e?e[0]?a(e[0]):t(e[1]):t(e)))}))});const{app:E,Vuex:f,Pinia:V}={app:e.createVueApp(k)};uni.Vuex=f,uni.Pinia=V,E.provide("__globalStyles",__uniConfig.styles),E._component.mpType="app",E._component.render=()=>{},E.mount("#app")}(Vue);
